<p-toolbar styleClass="mb-6">
  <ng-template #start>
    <div class="flex items-center gap-2">
      <p-button
        icon="pi pi-arrow-left"
        variant="outlined"
        severity="contrast"
        rounded
        (click)="navigateToStudent()"
      ></p-button>
      <span class="text-2xl font-bold">Detalles del Dictamen</span>
    </div>
  </ng-template>
  <ng-template #end>
    <div class="flex gap-2">
      <p-button
        label="Actualizar datos"
        icon="pi pi-refresh"
        [outlined]="true"
      />
    </div>
  </ng-template>
</p-toolbar>

<div
  *ngIf="isLoading"
  class="card flex items-center justify-center py-8"
>
  <i class="pi pi-spinner pi-spin text-4xl text-primary"></i>
  <span class="ml-2 text-lg">Cargando...</span>
</div>

<div
  class="card grid"
  *ngIf="!isLoading"
>
  <div class="flex w-full flex-col gap-1 py-5">
    <div class="mb-2 grid grid-cols-12 gap-4">
      <label class="col-span-12 flex items-center text-lg font-semibold xs:text-xl sm:col-span-4 md:col-span-3">
        Nombre:
      </label>
      <div class="col-span-12 text-lg xs:text-xl sm:col-span-8 md:col-span-9">
        {{ reportSelected.student.name }} {{ reportSelected.student.firstSurname }}
        {{ reportSelected.student.secondSurname }}
      </div>
    </div>

    <div class="mb-2 grid grid-cols-12 gap-4">
      <label class="col-span-12 flex items-center text-lg font-semibold xs:text-xl sm:col-span-4 md:col-span-3">
        Matrícula:
      </label>
      <div class="col-span-12 text-lg xs:text-xl sm:col-span-8 md:col-span-9">
        {{ reportSelected.student.studentCode }}
      </div>
    </div>

    <div class="mb-2 grid grid-cols-12 gap-4">
      <label class="col-span-12 flex items-center text-lg font-semibold xs:text-xl sm:col-span-4 md:col-span-3">
        Número de teléfono:
      </label>
      <div class="col-span-12 text-lg xs:text-xl sm:col-span-8 md:col-span-9">
        {{ reportSelected.student.phoneNumber }}
      </div>
    </div>
  </div>

  <div class="flex w-full flex-col gap-1">
    <div class="mb-2 grid grid-cols-12 items-center gap-6">
      <div class="col-span-12 md:col-span-6">
        <div
          *ngIf="isLoadingImage"
          class="flex items-center justify-center py-8"
        >
          <i class="pi pi-spinner pi-spin text-4xl text-primary"></i>
          <span class="ml-2 text-lg">Cargando imágenes...</span>
        </div>
        <p-galleria
          *ngIf="!isLoadingImage && reportSelectedImages.length > 0"
          [value]="reportSelectedImages"
          [containerStyle]="{ 'max-width': '640px' }"
          [circular]="true"
          [showIndicators]="true"
          [showThumbnails]="false"
          [showItemNavigators]="true"
        >
          <ng-template
            pTemplate="item"
            let-item
          >
            <img
              *ngIf="item.loaded && item.objectUrl"
              [src]="item.objectUrl"
              style="width: 100%; height: 400px; display: block; object-fit: contain"
            />
            <div
              *ngIf="!item.loaded"
              class="flex flex-col items-center justify-center rounded bg-gray-100"
              style="width: 100%; height: 400px"
            >
              <i class="pi pi-image mb-3 text-6xl text-gray-400"></i>
              <span class="px-4 text-center text-gray-500">Error al cargar imagen</span>
              <span class="mt-1 break-all px-4 text-center text-xs text-gray-400">
                {{ item.url.split('/').pop() }}
              </span>
            </div>
          </ng-template>
        </p-galleria>
        <div
          *ngIf="!isLoadingImage && reportSelectedImages.length === 0"
          class="flex h-64 items-center justify-center rounded bg-gray-50"
        >
          <div class="text-center">
            <i class="pi pi-image mb-2 text-4xl text-gray-400"></i>
            <p class="text-gray-500">No hay imágenes disponibles</p>
          </div>
        </div>
      </div>
      <div class="col-span-12 md:col-span-6">
        <div class="mb-2 text-lg font-semibold xs:text-xl">
          <b>Resultados del Análisis:</b>
          {{ reportSelected.student.predictionResult + '%' }}
        </div>
        <div class="mb-2 text-lg xs:text-xl">
          <b>Fecha de análisis:</b>
          {{ reportSelected.createdAt | date: 'dd/MM/yyyy hh:mm:ss a' }}
        </div>
        <div class="mb-2 text-lg xs:text-xl">
          <b>Temperatura:</b>
          {{ reportSelected.temperature }}°C
        </div>
        <div class="mb-2 text-lg xs:text-xl">
          <b>Frecuencia cardiaca:</b>
          {{ reportSelected.heartRate }} ppm
        </div>
        <div class="mb-2 text-lg xs:text-xl">
          <b>Presión arterial:</b>
          {{ reportSelected.systolicBloodPressure }}/{{ reportSelected.diastolicBloodPressure }} mmHg
        </div>
        <div class="mb-2 text-lg xs:text-xl">
          <b>Dilatación de pupila izquierda:</b>
          {{ reportSelected.pupilDilationLeft }} mm
        </div>
        <div class="mb-2 text-lg xs:text-xl">
          <b>Dilatación de pupila derecha:</b>
          {{ reportSelected.pupilDilationRight }} mm
        </div>
      </div>
    </div>
  </div>
</div>

<p-toast />
